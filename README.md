# ü§ñ CBR News Prediction

[![Python](https://img.shields.io/badge/python-3.10+-blue.svg)](https://www.python.org/)
[![PyTorch](https://img.shields.io/badge/PyTorch-2.0+-red.svg)](https://pytorch.org/)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)

**–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π –ë–∞–Ω–∫–∞ –†–æ—Å—Å–∏–∏ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–ª—é—á–µ–≤–æ–π —Å—Ç–∞–≤–∫–∏**

–ú–æ–¥–µ–ª—å –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç—ã –ø—Ä–µ—Å—Å-—Ä–µ–ª–∏–∑–æ–≤ –ë–∞–Ω–∫–∞ –†–æ—Å—Å–∏–∏ –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ –ø–æ –∫–ª—é—á–µ–≤–æ–π —Å—Ç–∞–≤–∫–µ: –ø–æ–≤—ã—à–µ–Ω–∏–µ üìà, –ø–æ–Ω–∏–∂–µ–Ω–∏–µ üìâ –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚û°Ô∏è.

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–¢–æ—á–Ω–æ—Å—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä–æ–≤ (RuBERT)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö**: –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ –ë–∞–Ω–∫–∞ –†–æ—Å—Å–∏–∏
- **–ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: Hydra –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤**: MLflow –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: DVC –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞—Ç–∞—Å–µ—Ç–∞–º–∏
- **–û–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Yandex Object Storage

## üéØ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|-----------|----------|--------|
| `down` üìâ | –ü–æ–Ω–∏–∂–µ–Ω–∏–µ –∫–ª—é—á–µ–≤–æ–π —Å—Ç–∞–≤–∫–∏ | "–ë–∞–Ω–∫ –†–æ—Å—Å–∏–∏ —Å–Ω–∏–∑–∏–ª –∫–ª—é—á–µ–≤—É—é —Å—Ç–∞–≤–∫—É –Ω–∞ 0.25%" |
| `same` ‚û°Ô∏è | –°—Ç–∞–≤–∫–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π | "–°–æ–≤–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–≤ –ø—Ä–∏–Ω—è–ª —Ä–µ—à–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞–≤–∫—É" |
| `up` üìà | –ü–æ–≤—ã—à–µ–Ω–∏–µ –∫–ª—é—á–µ–≤–æ–π —Å—Ç–∞–≤–∫–∏ | "–ö–ª—é—á–µ–≤–∞—è —Å—Ç–∞–≤–∫–∞ –ø–æ–≤—ã—à–µ–Ω–∞ –¥–æ 8.5%" |

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
üìÅ cbr-news-prediction/
‚îú‚îÄ‚îÄ üìÇ configs/          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã Hydra
‚îÇ   ‚îú‚îÄ‚îÄ config.yaml      # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ data.yaml        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ DVC
‚îÇ   ‚îú‚îÄ‚îÄ model.yaml       # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ train.yaml       # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
‚îú‚îÄ‚îÄ üìÇ cbr_news/         # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ Python
‚îÇ   ‚îú‚îÄ‚îÄ train.py         # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ model.py         # PyTorch Lightning –º–æ–¥–µ–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ dataset.py       # DataModule –∏ Dataset
‚îÇ   ‚îú‚îÄ‚îÄ data_loader.py   # –ó–∞–≥—Ä—É–∑—á–∏–∫ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ parser.py        # –ü–∞—Ä—Å–µ—Ä —Å–∞–π—Ç–∞ –ë–∞–Ω–∫–∞ –†–æ—Å—Å–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ utils.py         # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ üìÇ data/             # –î–∞–Ω–Ω—ã–µ (—É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ DVC)
‚îú‚îÄ‚îÄ üìÇ outputs/          # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
‚îú‚îÄ‚îÄ üìÇ checkpoints/      # –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ üìÇ mlruns/           # –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã MLflow
‚îî‚îÄ‚îÄ üìÇ tests/            # –¢–µ—Å—Ç—ã
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Python 3.10+**
- **Poetry** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- **CUDA** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏)

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone https://github.com/yourusername/cbr-news-prediction.git
cd cbr-news-prediction

# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
poetry install
poetry shell

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ pre-commit —Ö—É–∫–æ–≤
pre-commit install
pre-commit run -a
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DVC (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DVC
dvc init

```

### 3. –ó–∞–ø—É—Å–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏

```bash
# –ó–∞–ø—É—Å–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
poetry run python train.py
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç [Hydra](https://hydra.cc/) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π. –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

### –ú–æ–¥–µ–ª—å (`configs/model.yaml`)
```yaml
model:
  backbone: "cointegrated/rubert-tiny2"  # –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä–Ω–∞—è –º–æ–¥–µ–ª—å
  num_classes: 3                        # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Å–æ–≤
  dropout: 0.1                          # Dropout rate
  learning_rate: 2.0e-05               # Learning rate
  weight_decay: 0.01                   # Weight decay
  warmup_steps: 100                    # Warmup steps
  freeze_backbone: false               # –ó–∞–º–æ—Ä–æ–∑–∫–∞ backbone
```

### –î–∞–Ω–Ω—ã–µ (`configs/data.yaml`)
```yaml
data:
  dataset_path: "data/cbr_news.csv"
  max_length: 512                      # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞
  batch_size: 16                       # –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞
  test_size: 0.2                       # –†–∞–∑–º–µ—Ä —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–∏
  val_size: 0.1                        # –†–∞–∑–º–µ—Ä –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–æ–π –≤—ã–±–æ—Ä–∫–∏

  # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ DVC
  dvc:
    enabled: true
    remote:
      name: "s3remote"
      url: "s3://your-bucket/"
      region_name: "ru-central1"
      endpoint_url: "https://storage.yandexcloud.net/"
```

### –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ (`configs/train.yaml`)
```yaml
training:
  max_epochs: 10                       # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ø–æ—Ö
  gradient_clip_val: 1.0               # Gradient clipping
  monitor: "val_loss"                  # –ú–µ—Ç—Ä–∏–∫–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
  mode: "min"                          # –†–µ–∂–∏–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
  patience: 3                          # Patience –¥–ª—è early stopping

  # MLflow –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  mlflow:
    tracking_uri: "http://127.0.0.1:5050"
    experiment_name: "cbr_news"
    log_artifacts: true
    log_model: true
```

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
- **Accuracy**: —Ç–æ—á–Ω–æ—Å—Ç—å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **F1-Score**: –≥–∞—Ä–º–æ–Ω–∏—á–µ—Å–∫–æ–µ —Å—Ä–µ–¥–Ω–µ–µ precision –∏ recall
- **Loss**: —Ñ—É–Ω–∫—Ü–∏—è –ø–æ—Ç–µ—Ä—å


## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### MLflow

```bash
# –ó–∞–ø—É—Å–∫ MLflow —Å–µ—Ä–≤–µ—Ä–∞
mlflow server --host 127.0.0.1 --port 5050

# –ü—Ä–æ—Å–º–æ—Ç—Ä —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤
# –û—Ç–∫—Ä–æ–π—Ç–µ http://127.0.0.1:5050 –≤ –±—Ä–∞—É–∑–µ—Ä–µ
```

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

**Andrey Potseluev**

- Email: ampotseluev@edu.hse.ru
- GitHub: [@pAndrey200](https://github.com/pAndrey200)

---

‚≠ê **–ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –æ–∫–∞–∑–∞–ª—Å—è –ø–æ–ª–µ–∑–Ω—ã–º, –ø–æ—Å—Ç–∞–≤—å—Ç–µ –∑–≤–µ–∑–¥—É!**
